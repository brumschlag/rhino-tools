connection( 
	"Connection",
	ConnectionType: SqlConnection,
	ConnectionString: "Data Source=localhost;Initial Catalog=ETL_Test; Integrated Security=SSPI;"
	)

source UsersSource, Connection="Connection":
	Command: "SELECT Id, Name, Email FROM Users_Source"

source WebServiceGenerator:
	execute:
		whois = WebService(WsdlUrl: "http://localhost:9090/GetEmployees.asmx?wsdl" )
		results = whois.GetEmployees("Northwind")
		for result in results:
			SendRow( Row(
				Id: result.Id,
				Name: result.Name
				))
	
transform SplitName:
	Row.FirstName = Row.Name.Split(char(' '))[0]
	Row.LastName = Row.Name.Split(char(' '))[1]
	
transform RemoveRowsWithBadId:
	RemoveRow() if not Row.Email.Contains('@')

destination UsersDestination, Connection = "Connection":
	Command: """INSERT INTO Users_Destination (UserId, [First Name], [Last Name], Email)
				VALUES (@Id, @FirstName, @LastName, @Email)
			 """

pipeline CopyUsers:
	UsersSource >> SplitName
	SplitName >> RemoveRowsWithBadId
	RemoveRowsWithBadId >> UsersDestination
	
target default:
	Execute("CopyUsers")